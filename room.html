<!doctype html>
<html>

<head>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <meta charset="utf-8">
  <title>Streaming Party - BLACKPINK SRI LANKA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="stylesheet" href="css/room.css">
</head>

<body class="room-page">

  <!-- Background Effects -->
  <div class="room-bg">
    <div class="room-bg-glow room-bg-glow--1"></div>
    <div class="room-bg-glow room-bg-glow--2"></div>
    <div class="room-bg-glow room-bg-glow--3"></div>
    <div class="room-bg-dynamic" id="dynamicBg"></div>
  </div>

  <!-- Floating Particles -->
  <div class="room-particles" id="roomParticles"></div>

  <!-- Chat Bubble Layer (floating messages) -->
  <div class="room-bubble-layer" id="chatBubbleLayer"></div>

  <!-- Event Overlay (full-screen mini event animations) -->
  <div class="room-event-overlay" id="eventOverlay"></div>


  <!-- Last.fm Link Modal -->
  <div class="room-modal-backdrop" id="lastfmModal" style="display:none;">
    <div class="room-modal">
      <div class="room-modal-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M9 18V5l12-2v13" />
          <circle cx="6" cy="18" r="3" />
          <circle cx="18" cy="16" r="3" />
        </svg>
      </div>
      <div class="room-modal-title">Link Your Last.fm</div>
      <div class="room-modal-desc">Connect your Last.fm account to track your streaming and compete on the leaderboard.
      </div>
      <input type="text" class="room-modal-input" id="lastfmUsernameInput" placeholder="Your Last.fm username"
        autocomplete="off">
      <div class="room-modal-hint">Using Pano Scrobbler? Your streams are already being tracked!</div>
      <div class="room-modal-actions">
        <button class="room-modal-btn room-modal-btn--secondary" id="lastfmSkipBtn">Skip for now</button>
        <button class="room-modal-btn room-modal-btn--primary" id="lastfmLinkBtn">Link Account</button>
      </div>
    </div>
  </div>

  <!-- Loading Screen -->
  <div class="room-loading" id="roomLoading">
    <div class="room-loading-vinyl">
      <div class="room-loading-vinyl-disc"></div>
    </div>
    <div class="room-loading-text">Joining the party<span class="room-loading-dots">...</span></div>
  </div>

  <!-- Top Bar -->
  <div class="room-topbar" id="roomTopbar" style="display:none;">
    <div class="room-topbar-left">
      <a class="room-topbar-back" href="members.html" title="Back to rooms">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
          stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </a>
      <div class="room-topbar-info">
        <div class="room-topbar-title">
          <span class="room-topbar-live-dot"></span>
          SP Online
        </div>
        <div class="room-topbar-subtitle" id="onlineCount">0 online</div>
      </div>
    </div>
    <div class="room-topbar-right">
      <!-- Check-in for offline tracking -->
      <div class="room-checkin" id="checkInContainer">
        <button class="room-checkin-btn" id="checkInBtn" title="Check in to start tracking your streams">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
            stroke-linejoin="round" width="14" height="14">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <span>Check In to Track</span>
        </button>
        <div class="room-checkin-status" id="checkInStatus" style="display:none;">
          <span class="room-checkin-dot"></span>
          <span class="room-checkin-label">Tracking</span>
          <span class="room-checkin-timer" id="checkInTimer">60:00</span>
        </div>
      </div>
      <div class="room-topbar-profile" id="roomProfileBtn">
        <span id="roomProfileInitial">?</span>
      </div>
    </div>
  </div>

  <!-- Main Layout -->
  <div class="room-layout" id="roomLayout" style="display:none;">

    <!-- LEFT PANEL: Leaderboard -->
    <div class="room-panel room-panel--leaderboard room-panel--active" id="panelLeaderboard">
      <div class="room-panel-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="#ffc107" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round" width="16" height="16">
          <polygon
            points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
          </polygon>
        </svg>
        <span>Leaderboard</span>
      </div>

      <!-- Top 3 Podium -->
      <div class="room-podium" id="leaderboardPodium">
        <!-- Dynamically populated -->
      </div>

      <!-- Rest of leaderboard -->
      <div class="room-leaderboard-list" id="leaderboardList">
        <!-- Dynamically populated -->
      </div>

      <!-- Current user pinned -->
      <div class="room-leaderboard-self" id="leaderboardSelf" style="display:none;">
        <!-- Dynamically populated -->
      </div>
    </div>

    <!-- CENTER PANEL: Stage -->
    <div class="room-panel room-panel--stage room-panel--active" id="panelStage">

      <!-- Stats Card -->
      <div class="room-stats-card" id="statsCard">
        <div class="room-vinyl-wrap room-vinyl-wrap--small">
          <div class="room-vinyl" id="roomVinyl">
            <div class="room-vinyl-groove room-vinyl-groove--1"></div>
            <div class="room-vinyl-groove room-vinyl-groove--2"></div>
            <div class="room-vinyl-groove room-vinyl-groove--3"></div>
            <div class="room-vinyl-label">
              <div class="room-vinyl-label-inner"></div>
            </div>
          </div>
          <div class="room-vinyl-glow"></div>
        </div>
        <div class="room-stats-info">
          <div class="room-stats-collective-label">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="12" height="12">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            <span>BLINKs Unite! Combined Power</span>
          </div>
          <div class="room-stats-counts">
            <div class="room-stats-platform room-stats-platform--yt">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M23.5 6.19a3.02 3.02 0 00-2.12-2.14C19.54 3.5 12 3.5 12 3.5s-7.54 0-9.38.55A3.02 3.02 0 00.5 6.19 31.74 31.74 0 000 12a31.74 31.74 0 00.5 5.81 3.02 3.02 0 002.12 2.14c1.84.55 9.38.55 9.38.55s7.54 0 9.38-.55a3.02 3.02 0 002.12-2.14A31.74 31.74 0 0024 12a31.74 31.74 0 00-.5-5.81zM9.55 15.57V8.43L15.82 12l-6.27 3.57z"/>
              </svg>
              <span class="room-stats-platform-count" id="ytStreamCount">0</span>
              <span class="room-stats-platform-label">YouTube</span>
            </div>
            <div class="room-stats-divider"></div>
            <div class="room-stats-platform room-stats-platform--sp">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.52 17.34c-.24.36-.66.48-1.02.24-2.82-1.74-6.36-2.1-10.56-1.14-.42.12-.78-.18-.9-.54-.12-.42.18-.78.54-.9 4.56-1.02 8.52-.6 11.7 1.32.42.18.48.66.24 1.02zm1.44-3.3c-.3.42-.84.6-1.26.3-3.24-1.98-8.16-2.58-11.94-1.38-.48.12-.99-.12-1.11-.6-.12-.48.12-.99.6-1.11 4.38-1.32 9.78-.66 13.5 1.62.36.18.54.78.21 1.17zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.3c-.6.18-1.2-.18-1.38-.72-.18-.6.18-1.2.72-1.38 4.26-1.26 11.28-1.02 15.72 1.62.54.3.72 1.02.42 1.56-.3.42-.96.6-1.5.3z"/>
              </svg>
              <span class="room-stats-platform-count" id="spStreamCount">0</span>
              <span class="room-stats-platform-label">Spotify</span>
            </div>
          </div>
          <div class="room-stats-energy" id="statsEnergy">
            <div class="room-stats-energy-bar">
              <div class="room-stats-energy-fill" id="statsEnergyFill"></div>
            </div>
            <div class="room-stats-energy-label">
              <svg viewBox="0 0 24 24" fill="currentColor" width="12" height="12">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
              </svg>
              <span id="statsEnergyCount">0</span>/100 streams
            </div>
          </div>
        </div>
      </div>

      <!-- Stream Counter (Verified â€” expandable) -->
      <div class="room-stream-counter" id="streamCounter">
        <div class="room-stream-counter-header" id="streamCounterToggle">
          <div class="room-stream-counter-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
          </div>
          <div class="room-stream-counter-info">
            <div class="room-stream-counter-number" id="streamCountNumber">0</div>
            <div class="room-stream-counter-label">verified streams</div>
          </div>
          <div class="room-stream-counter-chevron" id="streamCounterChevron">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="14" height="14">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </div>
        <div class="room-stream-counter-breakdown" id="streamCounterBreakdown">
          <div class="room-stream-breakdown-row room-stream-breakdown-row--main">
            <span class="room-stream-breakdown-label">Kill This Love</span>
            <span class="room-stream-breakdown-value" id="breakdownMainTotal">0</span>
          </div>
          <div class="room-stream-breakdown-sub">
            <div class="room-stream-breakdown-row room-stream-breakdown-row--sub">
              <span class="room-stream-breakdown-dot room-stream-breakdown-dot--sp"></span>
              <span class="room-stream-breakdown-label">Spotify</span>
              <span class="room-stream-breakdown-value" id="breakdownMainSpotify">0</span>
            </div>
            <div class="room-stream-breakdown-row room-stream-breakdown-row--sub">
              <span class="room-stream-breakdown-dot room-stream-breakdown-dot--yt"></span>
              <span class="room-stream-breakdown-label">YouTube</span>
              <span class="room-stream-breakdown-value" id="breakdownMainYoutube">0</span>
            </div>
          </div>
          <div class="room-stream-breakdown-divider"></div>
          <div class="room-stream-breakdown-row">
            <span class="room-stream-breakdown-label">All BLACKPINK Streams</span>
            <span class="room-stream-breakdown-value" id="breakdownBlackpink">0</span>
          </div>
          <div class="room-stream-breakdown-row">
            <span class="room-stream-breakdown-label">Other Streams</span>
            <span class="room-stream-breakdown-value" id="breakdownOther">0</span>
          </div>
        </div>
      </div>

      <!-- Voice Message Bubbles (Top 5 players) -->
      <div class="room-voice-container" id="voiceBubbleContainer" style="display:none;">
        <div class="room-voice-bar" id="voiceBubbleBar">
          <!-- Dynamically populated voice message bubbles -->
        </div>
      </div>

      <!-- Persistent twinning mini cards -->
      <div class="room-twin-cards" id="twinCards"></div>

      <!-- Toast Container (mini event notifications) -->
      <div class="room-toast-container" id="toastContainer"></div>

      <!-- Chat Log (collapsible, last 15 messages) -->
      <div class="room-chat-log" id="chatLog">
        <div class="room-chat-log-toggle" id="chatLogToggle">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" width="14" height="14">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
          </svg>
          <span>Chat</span>
        </div>
        <div class="room-chat-log-messages" id="chatLogMessages">
          <!-- Dynamically populated -->
        </div>
      </div>

      <!-- Chat Input -->
      <div class="room-chat-input-bar" id="chatInputBar">
        <div class="room-chat-reactions">
          <button class="room-reaction-btn" data-emoji="fire" title="Fire">&#128293;</button>
          <button class="room-reaction-btn" data-emoji="heart" title="Heart">&#128149;</button>
          <button class="room-reaction-btn" data-emoji="purple_heart" title="Purple Heart">&#128156;</button>
          <button class="room-reaction-btn" data-emoji="crown" title="Crown">&#128081;</button>
          <button class="room-reaction-btn" data-emoji="lightstick" title="Lightstick">&#128526;</button>
        </div>
        <div class="room-chat-input-wrap">
          <input type="text" class="room-chat-input" id="chatInput" placeholder="Say something..." maxlength="200"
            autocomplete="off">
          <button class="room-voice-btn" id="voiceRecordBtn" style="display:none;" title="Record voice message">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
              <line x1="12" y1="19" x2="12" y2="23"/>
              <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
          </button>
          <button class="room-chat-send-btn" id="chatSendBtn">
            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- RIGHT PANEL: Live Activity -->
    <div class="room-panel room-panel--activity room-panel--active" id="panelActivity">
      <div class="room-panel-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="#f7a6b9" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round" width="16" height="16">
          <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
          <path
            d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z">
          </path>
        </svg>
        <span>Live Activity</span>
      </div>

      <div class="room-activity-list" id="activityList">
        <!-- Dynamically populated -->
      </div>
    </div>

  </div>

  <!-- Mobile Bottom Tab Bar -->
  <div class="room-bottom-nav" id="bottomNav" style="display:none;">
    <button class="room-bottom-tab room-bottom-tab--active" data-panel="panelStage">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" width="20" height="20">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
      </svg>
      <span>Chat</span>
    </button>
    <button class="room-bottom-tab" data-panel="panelLeaderboard">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" width="20" height="20">
        <polygon
          points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
        </polygon>
      </svg>
      <span>Ranks</span>
    </button>
    <button class="room-bottom-tab" data-panel="panelActivity">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" width="20" height="20">
        <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
        <path
          d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z">
        </path>
      </svg>
      <span>Activity</span>
    </button>
  </div>

  <!-- Firebase SDK (Auth only - Firestore removed, replaced by Convex) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <!-- Convex Browser SDK -->
  <script src="https://unpkg.com/convex@1.3.1/dist/browser.bundle.js"></script>

  <!-- Agora RTM SDK -->
  <script src="https://cdn.jsdelivr.net/npm/agora-rtm-sdk@1.5.1/index.js"></script>

  <!-- Configuration and Auth -->
  <script src="js/firebase-config.js"></script>
  <script src="js/config.js"></script>
  <script src="js/convex-client.js"></script>
  <script src="js/auth.js"></script>

  <!-- Room Scripts (order matters) -->
  <script src="js/room/room-firebase.js"></script>
  <script src="js/room/room-agora.js"></script>
  <script src="js/room/room-lastfm.js"></script>
  <script src="js/room/room-chat.js"></script>
  <script src="js/room/room-leaderboard.js"></script>
  <script src="js/room/room-activity.js"></script>
  <script src="js/room/room-events.js"></script>
  <script src="js/room/room-voice.js"></script>
  <script src="js/room/room-animations.js"></script>
  <script src="js/room/room-atmosphere.js"></script>
  <script src="js/room/room-main.js"></script>

</body>

</html>