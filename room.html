<!doctype html>
<html>

<head>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <meta charset="utf-8">
  <title>Streaming Party - BLACKPINK SRI LANKA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/room.css">
</head>

<body class="room-page">

  <!-- Background Effects -->
  <div class="room-bg">
    <div class="room-bg-glow room-bg-glow--1"></div>
    <div class="room-bg-glow room-bg-glow--2"></div>
    <div class="room-bg-glow room-bg-glow--3"></div>
    <div class="room-bg-dynamic" id="dynamicBg"></div>
  </div>

  <!-- Floating Particles -->
  <div class="room-particles" id="roomParticles"></div>

  <!-- Chat Bubble Layer (floating messages) -->
  <div class="room-bubble-layer" id="chatBubbleLayer"></div>

  <!-- Event Overlay (full-screen mini event animations) -->
  <div class="room-event-overlay" id="eventOverlay"></div>

  <!-- Persistent twinning mini cards -->
  <div class="room-twin-cards" id="twinCards"></div>

  <!-- Last.fm Link Modal -->
  <div class="room-modal-backdrop" id="lastfmModal" style="display:none;">
    <div class="room-modal">
      <div class="room-modal-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>
        </svg>
      </div>
      <div class="room-modal-title">Link Your Last.fm</div>
      <div class="room-modal-desc">Connect your Last.fm account to track your streaming and compete on the leaderboard.</div>
      <input type="text" class="room-modal-input" id="lastfmUsernameInput" placeholder="Your Last.fm username" autocomplete="off">
      <div class="room-modal-hint">Using Pano Scrobbler? Your streams are already being tracked!</div>
      <div class="room-modal-actions">
        <button class="room-modal-btn room-modal-btn--secondary" id="lastfmSkipBtn">Skip for now</button>
        <button class="room-modal-btn room-modal-btn--primary" id="lastfmLinkBtn">Link Account</button>
      </div>
    </div>
  </div>

  <!-- Loading Screen -->
  <div class="room-loading" id="roomLoading">
    <div class="room-loading-vinyl">
      <div class="room-loading-vinyl-disc"></div>
    </div>
    <div class="room-loading-text">Joining the party<span class="room-loading-dots">...</span></div>
  </div>

  <!-- Top Bar -->
  <div class="room-topbar" id="roomTopbar" style="display:none;">
    <div class="room-topbar-left">
      <a class="room-topbar-back" href="members.html" title="Back to rooms">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </a>
      <div class="room-topbar-info">
        <div class="room-topbar-title">
          <span class="room-topbar-live-dot"></span>
          Streaming Party
        </div>
        <div class="room-topbar-subtitle" id="onlineCount">0 online</div>
      </div>
    </div>
    <div class="room-topbar-right">
      <div class="room-energy-meter" id="energyMeter" title="Room energy">
        <div class="room-energy-fill" id="energyFill"></div>
        <div class="room-energy-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" width="12" height="12"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        </div>
      </div>
      <div class="room-topbar-profile" id="roomProfileBtn">
        <span id="roomProfileInitial">?</span>
      </div>
    </div>
  </div>

  <!-- Main Layout -->
  <div class="room-layout" id="roomLayout" style="display:none;">

    <!-- LEFT PANEL: Leaderboard -->
    <div class="room-panel room-panel--leaderboard room-panel--active" id="panelLeaderboard">
      <div class="room-panel-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="#ffc107" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
        <span>Leaderboard</span>
      </div>

      <!-- Top 3 Podium -->
      <div class="room-podium" id="leaderboardPodium">
        <!-- Dynamically populated -->
      </div>

      <!-- Rest of leaderboard -->
      <div class="room-leaderboard-list" id="leaderboardList">
        <!-- Dynamically populated -->
      </div>

      <!-- Current user pinned -->
      <div class="room-leaderboard-self" id="leaderboardSelf" style="display:none;">
        <!-- Dynamically populated -->
      </div>
    </div>

    <!-- CENTER PANEL: Stage -->
    <div class="room-panel room-panel--stage room-panel--active" id="panelStage">

      <!-- Now Playing -->
      <div class="room-now-playing">
        <div class="room-vinyl-wrap">
          <div class="room-vinyl" id="roomVinyl">
            <div class="room-vinyl-groove room-vinyl-groove--1"></div>
            <div class="room-vinyl-groove room-vinyl-groove--2"></div>
            <div class="room-vinyl-groove room-vinyl-groove--3"></div>
            <div class="room-vinyl-label">
              <div class="room-vinyl-label-inner"></div>
            </div>
          </div>
          <div class="room-vinyl-glow"></div>
        </div>
        <div class="room-now-playing-info">
          <div class="room-now-playing-label">Most played right now</div>
          <div class="room-now-playing-title" id="roomSongTitle">Waiting for streams...</div>
          <div class="room-now-playing-artist" id="roomSongArtist">-</div>
          <div class="room-now-playing-eq">
            <div class="room-eq-bar" style="--eq-speed:0.5s;--eq-min:3px;--eq-max:14px;"></div>
            <div class="room-eq-bar" style="--eq-speed:0.35s;--eq-min:5px;--eq-max:18px;"></div>
            <div class="room-eq-bar" style="--eq-speed:0.6s;--eq-min:2px;--eq-max:10px;"></div>
            <div class="room-eq-bar" style="--eq-speed:0.4s;--eq-min:4px;--eq-max:16px;"></div>
          </div>
        </div>
      </div>

      <!-- Toast Container (mini event notifications) -->
      <div class="room-toast-container" id="toastContainer"></div>

      <!-- Chat Log (collapsible, last 15 messages) -->
      <div class="room-chat-log" id="chatLog">
        <div class="room-chat-log-toggle" id="chatLogToggle">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="14" height="14">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          <span>Chat</span>
        </div>
        <div class="room-chat-log-messages" id="chatLogMessages">
          <!-- Dynamically populated -->
        </div>
      </div>

      <!-- Chat Input -->
      <div class="room-chat-input-bar" id="chatInputBar">
        <div class="room-chat-reactions">
          <button class="room-reaction-btn" data-emoji="fire" title="Fire">&#128293;</button>
          <button class="room-reaction-btn" data-emoji="heart" title="Heart">&#128149;</button>
          <button class="room-reaction-btn" data-emoji="purple_heart" title="Purple Heart">&#128156;</button>
          <button class="room-reaction-btn" data-emoji="crown" title="Crown">&#128081;</button>
          <button class="room-reaction-btn" data-emoji="lightstick" title="Lightstick">&#128526;</button>
        </div>
        <div class="room-chat-input-wrap">
          <input type="text" class="room-chat-input" id="chatInput" placeholder="Say something..." maxlength="200" autocomplete="off">
          <button class="room-chat-send-btn" id="chatSendBtn">
            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
          </button>
        </div>
      </div>
    </div>

    <!-- RIGHT PANEL: Live Activity -->
    <div class="room-panel room-panel--activity room-panel--active" id="panelActivity">
      <div class="room-panel-header">
        <svg viewBox="0 0 24 24" fill="none" stroke="#f7a6b9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
          <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
          <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
        </svg>
        <span>Live Activity</span>
      </div>

      <div class="room-activity-list" id="activityList">
        <!-- Dynamically populated -->
      </div>
    </div>

  </div>

  <!-- Mobile Bottom Tab Bar -->
  <div class="room-bottom-nav" id="bottomNav" style="display:none;">
    <button class="room-bottom-tab room-bottom-tab--active" data-panel="panelStage">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
      </svg>
      <span>Chat</span>
    </button>
    <button class="room-bottom-tab" data-panel="panelLeaderboard">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
      </svg>
      <span>Ranks</span>
    </button>
    <button class="room-bottom-tab" data-panel="panelActivity">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
        <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
        <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
      </svg>
      <span>Activity</span>
    </button>
  </div>

  <!-- Firebase SDK (Auth only - Firestore removed, replaced by Convex) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <!-- Convex Browser SDK -->
  <script src="https://unpkg.com/convex@1.3.1/dist/browser.bundle.js"></script>

  <!-- Agora RTM SDK -->
  <script src="https://cdn.jsdelivr.net/npm/agora-rtm-sdk@1.5.1/index.js"></script>

  <!-- Configuration and Auth -->
  <script src="js/firebase-config.js"></script>
  <script src="js/config.js"></script>
  <script src="js/convex-client.js"></script>
  <script src="js/auth.js"></script>

  <!-- Room Scripts (order matters) -->
  <script src="js/room/room-firebase.js"></script>
  <script src="js/room/room-agora.js"></script>
  <script src="js/room/room-lastfm.js"></script>
  <script src="js/room/room-chat.js"></script>
  <script src="js/room/room-leaderboard.js"></script>
  <script src="js/room/room-activity.js"></script>
  <script src="js/room/room-events.js"></script>
  <script src="js/room/room-animations.js"></script>
  <script src="js/room/room-atmosphere.js"></script>
  <script src="js/room/room-main.js"></script>

</body>

</html>
